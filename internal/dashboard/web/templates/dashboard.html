<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scranton Strangler - Trading Dashboard</title>
    <script src="/static/js/htmx.min.js"></script>
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Scranton Strangler Trading Bot</h1>
            <div class="header-info">
                <span class="market-status {{if eq .MarketStatus "Open"}}open{{else}}closed{{end}}">
                    Market: {{.MarketStatus}}
                </span>
                <span class="account-balance">Balance: ${{printf "%.2f" .AccountBalance}}</span>
                <span class="last-update">Updated: {{.LastUpdate.Format "15:04:05"}}</span>
            </div>
        </header>

        <main>
            <section id="stats-section" class="dashboard-section">
                <h2>Performance Statistics</h2>
                <div id="stats-container" 
                     hx-get="/partials/stats" 
                     hx-trigger="load, every 30s"
                     hx-swap="innerHTML">
                    {{template "stats-content" .Stats}}
                </div>
            </section>

            <section id="positions-section" class="dashboard-section">
                <h2>Active Positions ({{.Stats.CurrentOpen}})</h2>
                <div id="positions-container"
                     hx-get="/partials/positions"
                     hx-trigger="load, every 15s"
                     hx-swap="innerHTML">
                    {{template "positions-content" .Positions}}
                </div>
            </section>

            <section id="position-detail-section" class="dashboard-section hidden">
                <h2>Position Details</h2>
                <div id="position-detail-container"></div>
            </section>
        </main>

        <footer>
            <p>Scranton Strangler v1.0.0 | Auto-refresh: 15s (positions) / 30s (stats)</p>
        </footer>
    </div>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>

{{define "stats-content"}}
<div class="stats-grid">
    <div class="stat-card">
        <h3>Win Rate</h3>
        <p class="stat-value {{if gt .WinRate 50.0}}positive{{else}}negative{{end}}">
            {{printf "%.1f" .WinRate}}%
        </p>
        <p class="stat-label">{{.WinningTrades}}/{{.TotalTrades}} trades</p>
    </div>
    
    <div class="stat-card">
        <h3>Total P&L</h3>
        <p class="stat-value {{if gt .TotalPnL 0}}positive{{else}}negative{{end}}">
            ${{printf "%.2f" .TotalPnL}}
        </p>
        <p class="stat-label">Avg: ${{printf "%.2f" .AveragePnL}}</p>
    </div>
    
    <div class="stat-card">
        <h3>Open Positions</h3>
        <p class="stat-value">{{.CurrentOpen}}</p>
        <p class="stat-label">Active trades</p>
    </div>
    
    <div class="stat-card">
        <h3>Allocation</h3>
        <p class="stat-value {{if gt .AllocationPct 35.0}}warning{{end}}">
            {{printf "%.1f" .AllocationPct}}%
        </p>
        <p class="stat-label">${{printf "%.2f" .TotalAllocated}} allocated</p>
    </div>
</div>
{{end}}

{{define "positions-content"}}
<div class="positions-table-wrapper">
    <table class="positions-table">
        <thead>
            <tr>
                <th>Symbol</th>
                <th>State</th>
                <th>Entry Date</th>
                <th>DTE</th>
                <th>Strikes</th>
                <th>Credit</th>
                <th>Current P&L</th>
                <th>P&L %</th>
                <th>Target/Stop</th>
            </tr>
        </thead>
        <tbody>
            {{range .}}
            <tr class="position-row {{if .IsProfit}}profit{{else}}loss{{end}}" 
                hx-get="/partials/position/{{.ID}}"
                hx-target="#position-detail-container"
                hx-swap="innerHTML"
                onclick="showPositionDetail()">
                <td>{{.Symbol}}</td>
                <td><span class="state-badge state-{{.State}}">{{.State}}</span></td>
                <td>{{.EntryDate.Format "01/02"}}</td>
                <td class="{{if lt .DTE 21}}warning{{end}}">{{.DTE}}</td>
                <td>{{printf "%.0f" .PutStrike}}/{{printf "%.0f" .CallStrike}}</td>
                <td>${{printf "%.2f" .CreditReceived}}</td>
                <td class="{{if .IsProfit}}positive{{else}}negative{{end}}">
                    ${{printf "%.2f" .CurrentPnL}}
                </td>
                <td class="{{if .IsProfit}}positive{{else}}negative{{end}}">
                    {{printf "%.1f" .PnLPercent}}%
                </td>
                <td>
                    <span class="target">${{printf "%.2f" .ProfitTarget}}</span> / 
                    <span class="stop">${{printf "%.2f" .StopLoss}}</span>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="9" class="no-data">No active positions</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>
{{end}}